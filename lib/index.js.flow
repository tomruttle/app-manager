// @flow

import { statuses, events } from './constants';

export type AppNameType = string;
export type SlotNameType = string;
export type FragmentNameType = string;

export type AnalyticsErrorType = {
  event: string,
  id?: string,
};

export type OptionsType = {
  importTimeout?: number,
};

export type AppType = {
  name: AppNameType,
  appPath: string,
  fragments: Array<FragmentNameType>,
};

export interface HistoryType {
  pushState(data: ?Object, title?: ?string, href?: string): void;
  replaceState(data: ?Object, title?: ?string, href?: string): void;
  getState(): Object;
  back(): void;
  forward(): void;
  events: {
    bind(event: string, callback: () => mixed): void,
    unbind(event: string): void,
    trigger(event: string, data?: mixed): void
  }
}

export interface ScriptVersion3Type {
  version: 3;
  hydrate(container: HTMLDivElement, history: HistoryType, currentApp: AppType): Promise<?void>;
  mount(container: HTMLDivElement, history: HistoryType, currentApp: AppType): Promise<?void>;
  unmount(container: HTMLDivElement, history: HistoryType, currentApp: AppType): boolean;
  onStateChange(history: HistoryType, currentApp: AppType): Promise<?void>;
}

export type ScriptType = ScriptVersion3Type;

export type SlotType = {
  name: SlotNameType,
  elementClass: string,
};

export type FragmentType = {
  name: FragmentNameType,
  slots: Array<SlotNameType>,
  managed: boolean,
  load?: () => Promise<ScriptType>,
};

export type ConfigType = {|
  apps: { [appName: AppNameType]: AppType },
  slots: { [slotName: SlotNameType]: SlotType },
  fragments: { [fragmentName: FragmentNameType]: FragmentType },
|};

declare export default class AppManager {
  static events: typeof events,
  static statuses: typeof statuses,

  static triggerEvent: (event: $Values<typeof events>, data: mixed) => void,
  static bindEvent: (event: $Values<typeof events>, callback: (data: mixed) => mixed) => void,
  static unbindEvent: (event: $Values<typeof events>) => void,

  constructor(config: ConfigType, options?: OptionsType): AppManager,

  init: () => Promise<boolean>,
}
